openapi: 3.0.3
info:
  title: Secret Handling Modes API
  version: 1.0.0
  description: API contract for secret handling mode selection and guardrails.
servers:
  - url: https://example.local
paths:
  /secrets/mode:
    post:
      summary: Evaluate secret handling mode and guardrails
      operationId: evaluateSecretMode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretModeRequest'
      responses:
        '200':
          description: Mode evaluation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeExecutionResult'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
components:
  schemas:
    SecretModeRequest:
      type: object
      required:
        - mode
      properties:
        mode:
          type: string
          enum: [reference, copyValue]
        copyValueGuardrail:
          $ref: '#/components/schemas/CopyValueGuardrail'
        secretUris:
          type: array
          items:
            type: string
    CopyValueGuardrail:
      type: object
      properties:
        flagProvided:
          type: boolean
        secondaryConfirmation:
          type: string
        allowedKeys:
          type: array
          items:
            type: string
    SecretUriResolution:
      type: object
      properties:
        originalUri:
          type: string
        resolvedUri:
          type: string
        version:
          type: string
        isValid:
          type: boolean
        failureReason:
          type: string
    RedactionPolicy:
      type: object
      properties:
        enabled:
          type: boolean
        sensitivePatterns:
          type: array
          items:
            type: string
        redactedFields:
          type: array
          items:
            type: string
    ModeExecutionResult:
      type: object
      required:
        - mode
        - guardrailsSatisfied
        - redactionApplied
      properties:
        mode:
          type: string
          enum: [reference, copyValue]
        guardrailsSatisfied:
          type: boolean
        redactionApplied:
          type: boolean
        messages:
          type: array
          items:
            type: string
        resolutions:
          type: array
          items:
            $ref: '#/components/schemas/SecretUriResolution'
    ValidationError:
      type: object
      required:
        - message
      properties:
        message:
          type: string
        field:
          type: string
